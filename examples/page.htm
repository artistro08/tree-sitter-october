url = "/blog"
layout = "default"
title = "Blog"
description = "The blog page"

[blogPosts]
pageNumber = "{{ :page }}"
postsPerPage = 10
==
<?php
function onStart()
{
    $this['posts'] = Post::published()->get();
    $this['categories'] = Category::orderBy('name')->get();
}

function onRefresh()
{
    return ['#posts' => $this->renderPartial('posts')];
}
?>
==
<div class="container">
    <h1>{{ page.title }}</h1>
    <p>{{ page.description }}</p>

    {% if posts %}
        <div id="posts">
            {% for post in posts %}
                <article class="post">
                    <h2>{{ post.title }}</h2>
                    <div class="meta">
                        Posted on {{ post.published_at|date('F j, Y') }}
                        {% if post.categories %}
                            in {% for category in post.categories %}
                                <a href="{{ category.url }}">{{ category.name }}</a>{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="content">
                        {{ post.excerpt|raw }}
                    </div>
                    <a href="{{ post.url }}" class="read-more">Read more</a>
                </article>
            {% endfor %}
        </div>

        {% component 'blogPosts' %}
    {% else %}
        <p>No posts found.</p>
    {% endif %}

    {% partial 'sidebar' %}
</div>

{% flash %}
    <div class="alert alert-{{ type }}">
        {{ message }}
    </div>
{% endflash %}
